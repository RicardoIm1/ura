<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calificaciones - Computación I INAR0104</title>
  <link rel="stylesheet" href="/ura/css/estilo.css">
  <style>
    :root {
      --apple-gradient: linear-gradient(135deg, #007AFF 0%, #5856D6 100%);
      --apple-vibrant-blue: #007AFF;
      --apple-vibrant-green: #34C759;
      --apple-vibrant-red: #FF3B30;
      --apple-vibrant-yellow: #FFCC00;
      --apple-light-gray: #F2F2F7;
      --apple-gray: #8E8E93;
      --apple-dark-gray: #3A3A3C;
      --apple-black: #1D1D1F;
      --apple-white: #FFFFFF;
      --apple-transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      --apple-border-radius: 18px;
    }

    body {
      background-color: var(--apple-light-gray);
      color: var(--apple-black);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .container {
      flex: 1;
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
      width: 100%;
    }

    /* .header-content {
      background: var(--apple-white);
      padding: 20px;
      border-radius: var(--apple-border-radius);
      margin-bottom: 30px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      position: relative;
      overflow: hidden;
    }

    .header-content::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--apple-gradient);
    }

    .header-logo {
      height: 50px;
      width: auto;
    }

    .header-title {
      font-size: 28px;
      font-weight: 700;
      background: var(--apple-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    } */

    .section-title {
      margin-bottom: 20px;
      font-size: 32px;
      font-weight: 700;
      color: var(--apple-black);
      text-align: center;
      background: var(--apple-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* Estadísticas */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: var(--apple-white);
      padding: 20px;
      border-radius: var(--apple-border-radius);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      text-align: center;
      transition: var(--apple-transition);
    }

    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
    }

    .stat-card h3 {
      color: var(--apple-gray);
      font-size: 14px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 10px;
    }

    .stat-card .number {
      font-size: 32px;
      font-weight: 700;
      color: var(--apple-vibrant-blue);
    }

    /* Tabla de calificaciones */
    .tabla-container {
      position: relative;
      margin: 40px 0;
      overflow-x: auto;
      background: var(--apple-white);
      border-radius: var(--apple-border-radius);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
      padding: 20px;
    }

    .tabla-calificaciones {
      width: 100%;
      border-collapse: collapse;
      min-width: 1200px;
    }

    .tabla-calificaciones th {
      background: var(--apple-gradient);
      color: white;
      text-align: left;
      padding: 14px 16px;
      font-size: 16px;
      letter-spacing: 0.5px;
      font-weight: 600;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .tabla-calificaciones th:first-child {
      border-top-left-radius: 8px;
      position: sticky;
      left: 0;
      z-index: 11;
    }

    .tabla-calificaciones th:last-child {
      border-top-right-radius: 8px;
    }

    .tabla-calificaciones td {
      padding: 12px 16px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.08);
      color: var(--apple-black);
      font-size: 15px;
    }

    .tabla-calificaciones td:first-child {
      position: sticky;
      left: 0;
      background: var(--apple-white);
      font-weight: 600;
      color: var(--apple-vibrant-blue);
    }

    .tabla-calificaciones tr:nth-child(even) {
      background-color: var(--apple-light-gray);
    }

    .tabla-calificaciones tr:nth-child(even) td:first-child {
      background-color: var(--apple-light-gray);
    }

    .tabla-calificaciones tr:hover {
      background-color: rgba(0, 119, 204, 0.08);
      transition: 0.3s ease;
    }

    .tabla-calificaciones tr:hover td:first-child {
      background-color: rgba(0, 119, 204, 0.08);
    }

    /* Estilos para asistencias y faltas */
    .asistencia {
      color: var(--apple-vibrant-green);
      font-weight: 600;
      text-align: center;
      padding: 4px 8px;
      background: rgba(52, 199, 89, 0.1);
      border-radius: 6px;
      display: inline-block;
    }

    .falta {
      color: var(--apple-vibrant-red);
      font-weight: 600;
      text-align: center;
      padding: 4px 8px;
      background: rgba(255, 59, 48, 0.1);
      border-radius: 6px;
      display: inline-block;
    }

    .calificacion {
      font-weight: 700;
      text-align: center;
      color: var(--apple-vibrant-blue);
      background: rgba(0, 122, 255, 0.1);
      border-radius: 6px;
      padding: 6px 10px;
    }

    /* Loading y estados */
    .loading {
      text-align: center;
      padding: 40px;
      color: var(--apple-gray);
      font-size: 16px;
    }

    .loading::after {
      content: '';
      display: inline-block;
      width: 20px;
      height: 20px;
      margin-left: 10px;
      border: 2px solid var(--apple-light-gray);
      border-top-color: var(--apple-vibrant-blue);
      border-radius: 50%;
      animation: loading 0.6s linear infinite;
    }

    @keyframes loading {
      to { transform: rotate(360deg); }
    }

    .error {
      text-align: center;
      padding: 40px;
      color: var(--apple-vibrant-red);
      background: rgba(255, 59, 48, 0.05);
      border-radius: var(--apple-border-radius);
      margin: 20px 0;
      border: 1px solid rgba(255, 59, 48, 0.2);
    }

    /* Botones */
    .back-button {
      display: inline-block;
      margin-top: 30px;
      text-decoration: none;
      color: white;
      background: var(--apple-vibrant-blue);
      padding: 12px 24px;
      border-radius: 980px;
      transition: var(--apple-transition);
      font-weight: 600;
      font-size: 16px;
      letter-spacing: 0.5px;
      border: none;
      cursor: pointer;
    }

    .back-button:hover {
      background: var(--apple-vibrant-green);
      transform: scale(1.05);
    }

    .update-time {
      color: var(--apple-gray);
      font-size: 14px;
      text-align: right;
      margin-bottom: 20px;
      padding-right: 10px;
    }

    /* Footer */
    footer {
      text-align: center;
      padding: 20px;
      color: var(--apple-gray);
      font-size: 14px;
      background: var(--apple-white);
      margin-top: 40px;
      border-top: 1px solid rgba(0, 0, 0, 0.1);
    }

    .no-style-link {
      text-decoration: none;
      color: var(--apple-vibrant-blue);
      font-weight: 600;
    }

    .no-style-link:hover {
      text-decoration: underline;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .container {
        padding: 10px;
      }

      .header-content {
        flex-direction: column;
        text-align: center;
        gap: 10px;
        padding: 15px;
      }

      .header-title {
        font-size: 24px;
      }

      .section-title {
        font-size: 28px;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }

      .tabla-container {
        padding: 10px;
        margin: 20px -10px;
        border-radius: 0;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <a href="index.html">
        <img src="/ura/img/logo-ura.png" alt="Logotipo URA" class="header-logo">
      </a>
      <div class="header-title">
        Computación I - Calificaciones
      </div>
    </div>
  </header>

  <section class="container">
    <h1 class="section-title">Calificaciones del Curso</h1>
    
    <div class="update-time" id="updateTime"></div>
    
    <div class="stats-grid" id="stats">
      <!-- Las estadísticas se cargarán dinámicamente -->
    </div>

    <div class="tabla-container">
      <div class="loading" id="loading">
        Cargando datos de calificaciones...
      </div>
      
      <div class="error" id="error" style="display: none;">
        Error al cargar los datos. Por favor, intenta nuevamente.
      </div>

      <table class="tabla-calificaciones" id="calificacionesTable" style="display: none;">
        <thead id="tableHeader">
          <!-- Encabezados se cargarán dinámicamente -->
        </thead>
        <tbody id="tableBody">
          <!-- Datos se cargarán dinámicamente -->
        </tbody>
      </table>
    </div>

    <div style="text-align: center; margin-top: 30px;">
      <a href="/ura/" class="back-button">
        ← Volver al Inicio
      </a>
    </div>
  </section>

  <footer>
    © 2025 Universidad URA – Asignatura
    <a href="/ura/" class="no-style-link materias" target="_self">Inicio.</a>
  </footer>

  <script>
    // URL de tu Google Apps Script
    const GAS_URL = 'https://script.google.com/macros/s/AKfycby7MBTYVkfam6qZ0OHAiV6NmzMMCU3FGdEDxQOe24-y-TQyygFj56h8qKpV-U5BUbMD7A/exec';

    // Función para cargar datos usando JSONP
    function cargarDatos() {
      const loadingElement = document.getElementById('loading');
      const errorElement = document.getElementById('error');
      const tableElement = document.getElementById('calificacionesTable');
      
      // Crear script para JSONP
      const callbackName = 'callback_' + new Date().getTime();
      const script = document.createElement('script');
      script.src = `${GAS_URL}?callback=${callbackName}`;
      
      // Definir la función de callback
      window[callbackName] = function(data) {
        try {
          // Limpiar el script
          document.body.removeChild(script);
          delete window[callbackName];
          
          // Ocultar loading
          loadingElement.style.display = 'none';
          
          // Procesar los datos
          procesarDatos(data);
          
          // Mostrar la tabla
          tableElement.style.display = 'table';
          errorElement.style.display = 'none';
          
          // Actualizar hora
          document.getElementById('updateTime').textContent = 
            `Última actualización: ${new Date().toLocaleString()}`;
            
        } catch (error) {
          console.error('Error procesando datos:', error);
          mostrarError();
        }
      };
      
      // Manejar errores de carga
      script.onerror = function() {
        document.body.removeChild(script);
        delete window[callbackName];
        mostrarError();
      };
      
      // Agregar script al DOM
      document.body.appendChild(script);
    }
    
    function mostrarError() {
      document.getElementById('loading').style.display = 'none';
      document.getElementById('error').style.display = 'block';
      document.getElementById('calificacionesTable').style.display = 'none';
    }
    
    function procesarDatos(data) {
      // Actualizar título si hay datos de período
      if (data.periodo) {
        const periodoElement = document.createElement('div');
        periodoElement.className = 'periodo';
        periodoElement.textContent = data.periodo;
        periodoElement.style.cssText = 'text-align: center; color: var(--apple-gray); margin-bottom: 20px; font-size: 16px;';
        document.querySelector('.section-title').after(periodoElement);
      }
      
      // Calcular estadísticas
      const totalAlumnos = data.asistencias.alumnos.length;
      let totalAsistencias = 0;
      let totalFaltas = 0;
      let alumnosCompletos = 0;
      
      data.asistencias.alumnos.forEach(alumno => {
        alumno.asistencias.forEach(asistencia => {
          if (asistencia === 'ASISTENCIA') totalAsistencias++;
          if (asistencia === 'FALTA') totalFaltas++;
        });
        
        // Verificar si tiene asistencias registradas
        const asistenciasRegistradas = alumno.asistencias.filter(a => a !== '').length;
        if (asistenciasRegistradas > 0) alumnosCompletos++;
      });
      
      // Calcular porcentaje de asistencia
      const totalRegistros = totalAsistencias + totalFaltas;
      const porcentajeAsistencia = totalRegistros > 0 
        ? Math.round((totalAsistencias / totalRegistros) * 100) 
        : 0;
      
      // Actualizar estadísticas
      document.getElementById('stats').innerHTML = `
        <div class="stat-card">
          <h3>Total de Alumnos</h3>
          <div class="number">${totalAlumnos}</div>
        </div>
        <div class="stat-card">
          <h3>Asistencias</h3>
          <div class="number">${totalAsistencias}</div>
        </div>
        <div class="stat-card">
          <h3>Faltas</h3>
          <div class="number">${totalFaltas}</div>
        </div>
        <div class="stat-card">
          <h3>Asistencia</h3>
          <div class="number">${porcentajeAsistencia}%</div>
        </div>
      `;
      
      // Crear encabezados de la tabla
      const thead = document.getElementById('tableHeader');
      thead.innerHTML = '';
      const headerRow = document.createElement('tr');
      
      data.asistencias.columnas.forEach((columna, index) => {
        const th = document.createElement('th');
        th.textContent = columna;
        
        // Destacar columnas importantes
        if (columna.includes('CALIFICACION') || columna.includes('CALIFICACIÓN')) {
          th.style.background = 'linear-gradient(135deg, #FF9500 0%, #FF5E3A 100%)';
        }
        
        headerRow.appendChild(th);
      });
      
      thead.appendChild(headerRow);
      
      // Crear filas de alumnos
      const tbody = document.getElementById('tableBody');
      tbody.innerHTML = '';
      
      data.asistencias.alumnos.forEach((alumno) => {
        const row = document.createElement('tr');
        
        // Nombre del alumno
        const nombreCell = document.createElement('td');
        nombreCell.textContent = alumno.nombre;
        row.appendChild(nombreCell);
        
        // Asistencias (primeras 6 columnas)
        for (let i = 0; i < 6; i++) {
          const asistencia = alumno.asistencias[i] || '';
          const cell = document.createElement('td');
          
          if (asistencia === 'ASISTENCIA') {
            cell.innerHTML = '<span class="asistencia">ASISTENCIA</span>';
          } else if (asistencia === 'FALTA') {
            cell.innerHTML = '<span class="falta">FALTA</span>';
          } else {
            cell.textContent = asistencia;
          }
          
          row.appendChild(cell);
        }
        
        // Parcial 1
        const parcial1Cell = document.createElement('td');
        parcial1Cell.textContent = alumno.parcial1 || '';
        row.appendChild(parcial1Cell);
        
        // Parcial 2
        const parcial2Cell = document.createElement('td');
        parcial2Cell.textContent = alumno.parcial2 || '';
        row.appendChild(parcial2Cell);
        
        // Prácticas de laboratorio
        const practicasCell = document.createElement('td');
        practicasCell.textContent = alumno.practicas || '';
        row.appendChild(practicasCell);
        
        // Investigaciones bibliográficas
        const investigacionesCell = document.createElement('td');
        investigacionesCell.textContent = alumno.investigaciones || '';
        row.appendChild(investigacionesCell);
        
        // Examen Final
        const examenCell = document.createElement('td');
        examenCell.textContent = alumno.examenFinal || '';
        row.appendChild(examenCell);
        
        // Calificación Final
        const calificacionCell = document.createElement('td');
        calificacionCell.textContent = alumno.calificacion || '0';
        calificacionCell.className = 'calificacion';
        row.appendChild(calificacionCell);
        
        tbody.appendChild(row);
      });
    }
    
    // Cargar datos al iniciar
    document.addEventListener('DOMContentLoaded', function() {
      cargarDatos();
      
      // Recargar automáticamente cada 2 minutos
      setInterval(cargarDatos, 2 * 60 * 1000);
    });
  </script>
</body>
</html>